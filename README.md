# Ubuntu ISO builder

Script to easily build Ubuntu ISO images.

## How to use

To create a custom image configuration, make a copy of the example folder, and then edit the `iso.cfg` file to reflect the desired changes.

Then, run the `mkiso.sh` script, providing the new directory where your configuration is located, and an ISO image will be built

## Features

* Skips initial language selection, defaults to English, but customizable
* Skips keyboard selection, default to US, but customizable
* Simplify many common tasks needed/wanted when creating a custom image
* Auto password hashing if necessary for the default user (insecure - password will be in plain-text in local config file, but not in resulting image)
* Attempts to use an overlay fs (aufs) to prevent copying
* Fallback on RAM filesystem if aufs is not available, checks if enough RAM is available for image, otherwise fallback to disk. Uses rsync to copy CD contents.
* By default, at first first attempts to configure VM via DHCP, with a timeout of 10 seconds, default network configuration settings will be proposed if this fails.

### Settings

The following is an example configuration file (see the `example/` subfolder). All settings mentioned here are the defaults at the time of writing (subject to change), unless specifically mentioned

```
# Example config file

## Debug, set to non-empty value to enable debug mode when building the image.
## Has no impact on the resulting image
#DEBUG=

## Name/title of the customized install menu on the ISO
TITLE=Example

## Override the short lower-case title
## Default is the directory name where the config file is located.
## In case of the 'example/', "example" will be used unless specified here
#TITLE_LC=

## CD Volume name, will be auto-generated by default, cannot be longer than 32 characters
#VOLUME=

## Select Ubuntu version. Values represent (current?) defaults
#UBUNTU_ARCH="amd64"
#UBUNTU_VERSION="16.04"
#UBUNTU_SUBREL=".3"

## Advanced iso sourcing, specify an ISO URL.
## This could potentially be used to build Debian images, but you're on your own then.
## Default will be an Ubuntu download URL for the Ubuntu version specified above.
#ISOURL=

## Name of the ISO file.
## When empty, will be auto-generated based on the Ubuntu version, short title (TITLE_LC) and current date.
#ISOFILE=

## Keyboard/locale settings
#KEYBOARD_LAYOUT_CODE=us
#KEYBOARD_LAYOUT="English (US)"
#KEYBOARD_LAYOUT_VARIANT="English (US)"
#SETUP_LANGUAGE="en"
#SETUP_LOCALE="en_US.UTF-8"

## Country / timezone
#COUNTRY="BE"
#TIMEZONE="Europe/Brussels"

## Boot menu timeout in seconds
#BOOT_TIMEOUT="10"

## NTP settings
#NTP_ENABLED="true"
#NTP_SERVER="$(echo $COUNTRY|tr A-Z a-z).pool.ntp.org"

## Network configuration
#NET_DEF_IP=
#NET_DEF_GW=
#NET_DEF_MASK="255.255.255.0"
#NET_DEF_DNS="8.8.8.8 8.8.4.4"
#NET_DEF_HOST="host"
#NET_DEF_DOMAIN="default.domain"

## Package installation options
#INSTALL_TASKSEL="standard, ssh-server"
## Additional packages to install
#INSTALL_PACKAGES="openssh-server openssh-client python-minimal vim tree htop wget curl ntp netcat pv socat"

## Defailt user configuration
#USER_NAME="ubuntu"

## Password configuration
#HASH_ALGO="sha-512"
# Generate custom encrypted/hashed password with: `mkpasswd -m sha-512 -S $(pwgen -ns 16 1)`
# Hashed the password 'default'
#USER_PASSWORD_ENC='$6$WL0kMo4llngmOExw$lbX4qHVdxRtTY7lQpm4.caIsFk7mJJr385NEyL36PQD/fOo/jcFBHqxz2O7qoLGMDIAXkbF4/eLRSsgtUNMxk0'
# When specified like this, the script will hash it for you:
#USER_PASSWORD="default"
```

## Customizing the target machine after installation

If you need additional configuration of the installation, edit the `init.sh` script in the `init` subfolder.

The default init script will call the provided `ssh_authorized_keys.sh` which will copy a `authorized_keys` file to the `root` user and any user with a home directory under `/home`. To provide SSH keys, simply drop an `authorized_keys` file in the `init` folder and leave the `init.sh` script as-is

## Advanced preseed options

You can use your own preseed file by adding a copy of the `custom.seed` file in the `src` folder to your configuration folder, or by creating a `${TITLE_LC}.seed` (`TITLE_LC` default = configuration directory basename) file.

Note that the following variables written as `%VARNAME%` in that preseed file will be replaced by that variable's name (config options etc):

- `BOOT_TIMEOUT`
- `KEYBOARD_LAYOUT_CODE`
- `KEYBOARD_LAYOUT`
- `KEYBOARD_LAYOUT_VARIANT`
- `SETUP_LANGUAGE`
- `SETUP_LOCALE`
- `TITLE`
- `TITLE_LC`
- `UBUNTU_ARCH`
- `UBUNTU_VERSION`
- `UBUNTU_SUBREL`
- `COUNTRY`
- `TIMEZONE`
- `NTP_SERVER`
- `NTP_ENABLED`
- `NET_DEF_IP`
- `NET_DEF_GW`
- `NET_DEF_MASK`
- `NET_DEF_DNS`
- `NET_DEF_HOST`
- `NET_DEF_DOMAIN`
- `INSTALL_TASKSEL`
- `INSTALL_PACKAGES`
- `USER_NAME`
- `USER_PASSWORD`
- `USER_PASSWORD_ENC`

## Remarks

* Do not use the custom `init.sh` script after installation to add additional packages, use the `INSTALL_PACKAGES` setting for this.

